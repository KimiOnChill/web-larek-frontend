# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Макет
Макет предоставлен по ссылке.
[Link to Figma](https://www.figma.com/design/92C0vV1ZCsVpgN9cH2DZ2d/Yandex--%D0%92%D0%B5%D0%B1-%D0%BB%D0%B0%D1%80%D1%91%D0%BA-?node-id=201-9445&p=f&t=vSk2e25HzktweDDT-0)

## Ссылка на Github
https://github.com/KimiOnChill/web-larek-frontend

## Данные и типы данных, используемые в приложении
Интерфейс карточки:
```
export interface IItem {
  id: string;
  category: string;
  title: string;
  image: string;
  price: number | null;
  description: string;
  isBought: boolean;
}
```
Интерфейс покупателя:
```
export interface ICustomer {
  paymentMethod: '' | 'card' | 'cash';
  address: string;
  email: string;
  phone: string;
}
```
Интерфейс корзины с товарами:
```
export interface IBasket {
  itemsList: IItem[];
  counter: number;
  fullPrice: number;
}
```
Интерфейс страницы с отображением всех товаров:
```
export interface IGallery {
  preview: string | null; 
  itemsArr: IItem[];
  events: IEvents;
}
```
Интерфейс ответа сервера о заказе:
```
export interface IOrderResponse {
  id: string;
  total: number;
}
```
Данные галереи на главной странице:
```
export type TGallery = Pick<IGallery, 'itemsArr'>; 
```
Данные карточки товара в галерее:
```
export type TCardInfo = Pick<IItem, 'tag' | 'title' | 'image' | 'price'>;
```
Данные счетчика товаров на главной странице:
```
export type TCounter = Pick<IBasket, 'counter'>;
```
Данные счетчика товаров на главной странице:
```
export type TCounter = Pick<IBasket, 'counter'>;
```
Данные для модального окна карточки товара:
```
export type TItemCard = Pick<IItem, 'tag' | 'title' | 'image' | 'description'| 'isBought' | 'price'>;
```
Данные для модального окна корзины товаров:
```
export type TBasket = Pick<IBasket, 'itemsList' | 'counter' | 'fullPrice'>;
```
Данные для модального окна с типом оплаты и адресом покупателя:
```
export type TPaymentModal = Pick<ICustomer, 'paymentMethod' | 'address'>;
```
Данные для модального окна с типом почтой и телефоном покупателя:
```
export type TCustomerInfoModal = Pick<ICustomer, 'email' | 'phone'>;
```
Данные для модального окна с уведомлением о совершенном заказе:
```
export type TSuccessModal = Pick<IBasket, 'fullPrice'>; 
```

## Арихитектура проекта
Проект построен в парадигме MVP:
- слой данных, отвечает за хранение и изменение данных,
- слой представления, отвечает за отображение данных на странице, 
- слой коммуникации выполняет роль презентера и отвечает за связь представления и данных.

### Базовый код
#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер.
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие.
- `emit` - инициализация события.
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие. 

### Слой данных
Здесь описаны объекты, которые хранят данные и содержат методы для возвращения или сохранения данных. Все поля классов будут защищенные.\
Почти любое действие в объекте будет эммитить определенное событие, чтобы в слой предсваления вносились изменения.

#### Класс GalleryModel
Класс хранит массив всех товаров, а также хранит товар, выбранный покупателем.\
В полях класса хранятся следующие данные:
- `preview: string | null` - id товара, выбранного для просмотра в модальной окне.
- `itemsArr: IItem[]` - массив всех товаров, полученный с сервера.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
Класс предоставляет набор методов для взаимодействия с этими данными:
- `getItem(itemId: string): IItem` - для получения карточки товара по ее id для `preview`.
- `protected setItem(item: IItem): void` - защищенный метод для сохранения карточки товара по ее id в `preview`.
- `getItemList(): IItem[]` - для получения массива товаров с сервера.
- `setItemList(itemList: IItem[]): void` - для сохранения массива товаров, полученных с сервера.  

#### Класс BasketModel
Класс отвечает за хранение и логику работы с данными карточек товаров, которые добавлены пользователем в корзину.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `basketItemsList: IItem[]` - массив объектов выбранных товаров.
- `fullPrice: number` - сумма всех товаров.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
Класс предоставляет набор методов для взаимодействия с этими данными:
- `getBasket(): IItem[]` - для получения массива товаров в корзине.
- `setBasket(basketItems: IItem[]): void` - сохранение маччива выбранных товаров и суммы в полях класса.
- `addItem(item: IItem): void` - добавляет одну карточку в конец массива и вызывает событие изменения масива.
- `deleteItem(itemId: string, payload: Function | null): void` - удаляет карточку из массива. Если передан колбэк, то выполняет его после удаления, если нет, то вызывает событие изменения массива.
- `countAmount(): number` - считает количество товаров в корзине для использования этого значения в счетчике.
- `isPossibleToBuy(item: IItem): boolean` - определяет возможно ли купить товар.
- `clearBasket(): void` - полная очистка корзины. Вызовется после отправки заказа на сервер. 

#### Класс CustomerDataModel
Класс отвечает за хранение и логику работы с данными текущего покупателя.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся данные:
- `paymentMethod: string | null` - способ оплаты, выбранный покупателем. Всего три варианта: не указанный, кортой, наличными. 
- `address: string` - адрес покупателя.
- `email: string` - электронная почта покупателя.
- `phone: string` - телефон покупателя.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
Класс предоставляет набор методов для взаимодействия с этими данными:
- `setCustomerInfo(customerData: ICustomer): void` - сохраняет данные покупателя в классе.
- `checkCustomerValidation(data: TPaymentModal, fieldName: string): boolean` - проверяет на валидность данные покупателя, введенные в опредленное поле с именем `fieldName`. (заполенено поле или нет)

### Слой отображения
Все классы в слое отображения (представления) отвечают за отрисовку передаваемых в них данных внутри контейнера (DOM-элемент).

#### Класс Header 
Наследует класс `Component`, отображает количество товаров в корзине и содержит поля:
- `counter: number` - поле со значением счетчика.
- `counterElement: HTMLElement` - поле отображения значения счетчика на странице в элементе с классом `header__basket-counter`.
- `basketButton: HTMLButtonElement` - поле кнопки корзины в элементе с классом `header__basket`.
- `set counter(value: number)` - сеттер для обновления счетчика.

#### Класс Gallery
Наследует класс `Component`, отображает массив товаров для покупки на главной странице./
Класс содержит такие поля::
- `galleryElement: HTMLElement` - поле отображения массива товаров в элементе с классом `gallery`.
- `set gallery(items: HTMLElement[])` - сеттер для установки массива товаров.

#### Класс Card
Наследует класс `Component`, является родительским классом для отображения всех видов и экземпляров карточек товаров.\
В конструктор класса передается DOM элемент темплейта. В классе устанавлены слушатели на все интерактивные элементы, при взаимодействии с которыми генерируются соответствующие события.\
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Поля класса содержат элементы разметки элементов карточки: 
- `title: HTMLElement` - поле отображения названия товара.
- `price: HTMLElement` - поле отображения цены товара.
- `render(): HTMLElement` - метод возвращает карточку с установленными слушателями.

#### Класс CardInGallery
Расширяет класс `Card`, является родительским классом для карточки товара в модальном окне. Предназначен для отображения карточки товара в галерее.
Класс содержит такие поля:
- `tag: HTMLElement` - поле отображения тэга товара.
- `image: HTMLElement` - поле отображения картинки товара.

#### Класс CardInModal
Расширяет класс `CardInGallery`. Предназначен для отображения карточки товара в модальном окне.
Класс содержит такие поля:
- `description: HTMLElement` - поле отображения описания товара.
- `buyButton: HTMLButtonElement` - поле кнопки покупки товара.

#### Класс CardInBasket
Расширяет класс `Card`. Предназначен для отображения карточки товара в корзине товаров.
Класс содержит такие поля:
- `orederNuber: HTMLElement` - поле отображения порядкового номера товара в корзине.
- `removeButton: HTMLButtonElement` - поле кнопки удаления товара из корзины.

#### Класс Modal 
Наследует класс `Component`. Модальное окно - это независимое представление и оболочка, где в элемент с классoм `modal_content` будет склонировано содержимое темплейтов блоков. Предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.\
Класс содержит такие поля:
- `content: HTMLElement` - поле отображения склонированного контента.
- `closeModalButton: HTMLButtonElement` - поле кнопки закрытия модального окна.
- `set content(items: HTMLElement)` - сеттер для установки разметки контента.

#### Класс Basket
Наследует класс `Component`. Предназначен для отображения корзины товаров в модальном окне. Отображает карточки добавленных товаров в формате: номер по порядку, название товара, цена, кнопка удаления из корзины. Также отображает кнопку сабмита, которая активна, когда в корзине есть хотя бы один товар. Клик по кнопке передает в модальное окно контент формы оплаты и адреса. Рядом с кнопкой отображает суммарную стоимость всех товаров в корзине.\
Класс содержит такие поля:
- `listOfBoughtItems: HTMLElement` - поле отображения списка покупок.
- `submitButton: HTMLButtonElement` - поле кнопки оформления заказа.
- `fullPrice: HTMLElement` - поле отображения суммарной стоимости товаров.
Методы:
- `set basketItems(items: HTMLElement[])` - сеттер для установки массива товаров в корзине.
- `submit(handleSubmit: Function): void` - принимает обработчик, который передается при инициации события клика по кнопке сабмита.
- `activateButton: void` - активирует кнопку сабмита, когда в корзине есть товары.
- `set fullPrice(value: string)` - сеттер для установки суммарной стоимости товаров.

#### Класс Form
Наследует класс `Component`. Родительский класс для реализации форм для заполнения даных о покупателе. При изменении одного поля происходит эмит события о данном изменении. Предоставляет методы для отображения ошибок и управления активностью кнопки сабмита.\
Поля класса:
- `submitButton: HTMLButtonElement` - поле кнопки сабмита.
- `formErrors: HTMLElement` - поле для вывода ошибки валидации.
- `formName: string` - значение атрибута `name` формы для генерации события.
Методы:
- `set valid(value: boolean): void` - изменяет активность кнопки подтверждения.
- `set errors(value: string)` - сеттер для установки текста ошибки.
- `onInputChange(field: keyof T, value: string): void` - эмит события при взаимодействии с полями ввода.
- `submit(handleSubmit: Function): void` - принимает обработчик, который передается при инициации события клика по кнопке сабмита.

#### Класс FormPayAddress
Расширяет класс `Form`. Предназначен для отображения форм с выбором способа оплаты и укзанием адреса доставки.\
Поля класса:
- `paymentMethodButton: HTMLButtonElement[]` - поля для отображения кнопок способа оплаты.
- `addressInput: HTMLInputElement` - поле инпута для ввода адреса.

#### Класс FormCustomerData
Расширяет класс `Form`. Предназначен для отображения форм для ввода электронной почты и телефона.\
Поля класса:
- `emailInput: HTMLInputElement` - поля инпута для ввода электронной почты.
- `phoneInput: HTMLInputElement` - поле инпута для ввода номера телефона.

#### Класс Success
Наследует класс `Component`. Предназначен для отображения сообщения об успешном оформлении заказа в модальном окне. Отображает картинку и полную стоимость товаров в корзине.\
Поля класса:
- `imageElement: HTMLImageElement` - поле для картинки.
- `fullPrice: HTMLElement` - поле для вывода полной стоимости товаров в корзине.
Методы:
- `set fullPrice(value: string)` - сеттер для установки суммарной стоимости товаров.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных, которые генерируются классами моделями данных:*
- `items:changed` - изменение массива товаров каталога.
- `item:selected` - изменение открываемого в модальном окне товара.
- `basket:changed` - изменение списка товаров корзины.

*События, возникающие при взаимодействии пользователя с интерфейсом, генерируются классами, отвечающими за представление*
- `modal:open` - открытие модального окна.
- `modal:close` - закрытие модального окна.
- `item:select` - выбор карточки для её открытия в модальном окне.
- `basket:open` - открытие корзины с товарами в модальном окне при клике на иконку корзины на главном экране.
- `${formName}:open` - открытие конкретной формы по атрибуту `name`.
- `${formName}:input` - изменение данных в конкретной форме по атрибуту `name`.
- `${formName}.${field}:change` - изменение данных в конкретной форме по атрибуту `name` в конкретном поле.
- `${formName}:validation` - событие, сообщающее о необходимости валидации конкретной формы по её атрибуту `name` для определения активности кнопки.
- `${formName}:submit` - отправка конкретной формы по атрибуту `name`.
- `success:open` - открытие сообщения об успешном заказе в модальном окне при клике на кнопку сабмита в форме contacts.