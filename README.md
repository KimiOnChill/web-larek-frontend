# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Макет
Макет предоставлен по ссылке.
[Link to Figma](https://www.figma.com/design/92C0vV1ZCsVpgN9cH2DZ2d/Yandex--%D0%92%D0%B5%D0%B1-%D0%BB%D0%B0%D1%80%D1%91%D0%BA-?node-id=201-9445&p=f&t=vSk2e25HzktweDDT-0)

## Ссылка на Github
https://github.com/KimiOnChill/web-larek-frontend

## Данные и типы данных, используемые в приложении
Интерфейс карточки:
```
export interface IItem {
  id: string;
  tag: string;
  title: string;
  image: string;
  price: number | null;
  description: string;
  isBought: boolean;
}
```
Интерфейс покупателя:
```
export interface ICustomer {
  paymentMethod: '' | 'card' | 'cash';
  address: string;
  email: string;
  phone: string;
}
```
Интерфейс корзины с товарами:
```
export interface IBasket {
  itemsList: IItem[];
  counter: number;
  fullPrice: number;
}
```
Интерфейс страницы с отображением всех товаров:
```
export interface IGallery {
  preview: string | null; 
  itemsArr: IItem[];
}
```
Интерфейс ответа сервера о заказе:
```
export interface IOrderResponse {
  id: string;
  total: number;
}
```
Данные галереи на главной странице:
```
export type TGallery = Pick<IGallery, 'itemsArr'>; 
```
Данные карточки товара в галерее:
```
export type TCardInfo = Pick<IItem, 'tag' | 'title' | 'image' | 'price'>;
```
Данные счетчика товаров на главной странице:
```
export type TCounter = Pick<IBasket, 'counter'>;
```
Данные счетчика товаров на главной странице:
```
export type TCounter = Pick<IBasket, 'counter'>;
```
Данные для модального окна карточки товара:
```
export type TItemCard = Pick<IItem, 'tag' | 'title' | 'image' | 'description'| 'isBought' | 'price'>;
```
Данные для модального окна корзины товаров:
```
export type TBasket = Pick<IBasket, 'itemsList' | 'counter' | 'fullPrice'>;
```
Данные для модального окна с типом оплаты и адресом покупателя:
```
export type TPaymentModal = Pick<ICustomer, 'paymentMethod' | 'address'>;
```
Данные для модального окна с типом почтой и телефоном покупателя:
```
export type TCustomerInfoModal = Pick<ICustomer, 'email' | 'phone'>;
```
Данные для модального окна с уведомлением о совершенном заказе:
```
export type TSuccessModal = Pick<IBasket, 'fullPrice'>; 
```

## Арихитектура проекта
Проект построен в парадигме MVP:
- слой данных, отвечает за хранение и изменение данных,
- слой представления, отвечает за отображение данных на странице, 
- слой коммуникации выполняет роль презентера и отвечает за связь представления и данных.

### Базовый код
#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер.
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие.
- `emit` - инициализация события.
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие. 

### Слой данных
Здесь описаны объекты, которые хранят данные и содержат методы для возвращения или сохранения данных. Все поля классов будут защищенные.\
Почти любое действие в объекте будет эммитить определенное событие, чтобы в слой предсваления вносились изменения.
`!!поле класса пишется с _ когда в классе предусмотрен сеттер и геттер для определения совйства с таким же имменем. или когда данные по полю или свойству придут с сервера.`

#### Класс GalleryModel
Класс хранит массив всех товаров, а также хранит товар, выбранный покупателем.\
В полях класса хранятся следующие данные:
- `preview: string | null` - id товара, выбранного для просмотра в модальной окне.
- `itemsArr: IItem[]` - массив всех товаров, полученный с сервера.

Класс предоставляет набор методов для взаимодействия с этими данными:
- `getItem (itemId: string): IItem` - возвращает карточку товара по ее id.
- `getItemList(itemList: IItem[]): IItem[]` - возвращает массив товаров, полученных с сервера. 
- а также сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс BasketModel
Класс отвечает за хранение и логику работы с данными карточек товаров, которые добавлены пользователем в корзину.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `_itemsList: IItem[]` - массив объектов выбранных товаров.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс предоставляет набор методов для взаимодействия с этими данными:
- `addItem(item: IItem): void` - добавляет одну карточку в конец массива и вызывает событие изменеия масива.
- `deleteItem(itemId: string, payload: Function | null): void` - удаляет карточку из массива. Если передан колбэк, то выполняет его после удаления, если нет, то вызывает событие изменения массива.
- `countFullPrice(cardList: ICard[]): number` - считает количество товаров в корзине для использования этого значения в счетчике.
- `isPossibleToBuy(card: ICard): boolean` - определяет возможно ли купить товар.
- а также сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс CustomerDataModel
Класс отвечает за хранение и логику работы с данными текущего покупателя.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `paymentMethod: '' | 'card' | 'cash'` - способ оплаты, выбранный покупателем. Всего три варианта: не указанный, кортой, наличными. 
- `address: string` - адрес покупателя.
- `email: string` - электронная почта покупателя.
- `phone: string` - телефон покупателя.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс предоставляет набор методов для взаимодействия с этими данными:
- `setCustomerInfo(customerData: ICustomer): void` - сохраняет данные покупателя в классе.
- `checkValidation(data: Record<keyof TUserPublicInfo, string>): boolean` - проверяет объект с данными покупателя на валидность.
- а также сеттеры и геттеры для сохранения и получения данных из полей класса.

### Слой отображения
Все классы в слое отображения (представления) отвечают за отрисовку передаваемых в них данных внутри контейнера (DOM-элемент).

#### Класс Header 
Наследует класс `Component`, отображает количество товаров в корзине и имеет поля:
- `_counter: number` - поле со значением счетчика.
- `counterElement: HTMLElement` - поле отображения значения счетчика на странице в элементе с классом `header__basket-counter`.
- `basketButton: HTMLButtonElement` - поле кнопки корзины в элементе с классом `header__basket`.
- `counter (value: number)` - сеттер для обновления счетчика.

#### Класс Gallery
Наследует класс `Component`, отображает массив товаров для покупки на главной странице. Класс содержит такие поля::
- `_galleryElement: HTMLElement` - поле отображения массива товаров в элементе с классом `gallery`.
- `gallery (items: HTMLElement[])` - сеттер для получения массива товаров.

#### Класс Card
Наследует класс `Component`, является родительским классом для отображения всех видов и экземпляров карточек товаров.\
В конструктор класса передается DOM элемент темплейта. В классе устанавлены слушатели на все интерактивные элементы, при взаимодействии с которыми генерируются соответствующие события.\
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Поля класса содержат элементы разметки элементов карточки: 
- `tag: HTMLElement` - поле отображения тэга товара.
- `title: HTMLElement` - поле отображения названия товара.
- `image: HTMLElement` - поле отображения картинки товара.
- `price: HTMLElement` - поле отображения цены товара.
- `description: HTMLElement` - поле отображения описания товара.
- `render(): HTMLElement` - метод возвращает карточку с установленными слушателями.

#### Класс Modal 
Наследует класс `Component`. Модальное окно - это оболчка, где в элемент с классoм `modal_content` будет склонировано содержимое темплейтов блоков. Предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.\
Класс содержит такие поля:
- `_content: HTMLElement` - поле отображения склонированного контента.
- `closeModalButton: HTMLButtonElement` - поле кнопки закрытия модального окна.
- `content(items: HTMLElement)` - сеттер для разметки контента.

#### Класс ModalWithBasket
Расширяет класс `Modal`. Предназначен для реализации модального окна с корзиной товаров. Отображает карточки добавленных товаров в формате: номер по порядку, название товара, цена. кнопка удаления из корзины. Отображает активную кнопку, когда в корзине есть хотя бы один товар, когда корзина пуста, кнопка не активна. Клик по книпке открывает следующее модальное окно. Также отображает суммарную стоимость всех товаров в корзине.\
Класс содержит такие поля:
- `listOfBoughtItems: HTMLElement` - поле отображения списка покупок.
- `submitButton: HTMLButtonElement` - поле кнопки оформления заказа.
- `fullPrice: HTMLElement` - поле отображения суммарной цены товаров.

Методы:
- `submit(handleSubmit: Function): void` - принимает обработчик, который передается при инициации события клика по кнопке сабмита.

#### Класс ModalWithForm
Расширяет класс `Modal`. Предназначен для реализации модального окна с формой, содержащей поля ввода. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Поля класса:
- `submitButton: HTMLButtonElement` - кнопка сабмита.
- `_form: HTMLFormElement` - элемент формы.
- `formName: string` - значение атрибута `name` формы.
- `inputs: NodeListOf<HTMLInputElement>` - список всех полей ввода формы.
- `errors: Record<string>` - объект для вывода ошибок.

Методы:
- `setValid(isValid: boolean): void` - изменяет активность кнопки подтверждения.
- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы, где ключ - `name` инпута, значение - данные введенные пользователем.
- `setInputValues(data: Record<string, string>): void` - принимает объект с данными для заполнения полей формы.
- `setError(data: {value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода.
- `showInputError (errorMessage: string): void` - отображает полученный текст ошибки.
- `hideInputError (): void` - очищает текст ошибки.
- `close (): void` - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сабмита.
Методы:
- `submit(handleSubmit: Function): void` - принимает обработчик, который передается при инициации события клика по кнопке сабмита.
- `get form: HTMLElement` - геттер для получения элемента формы.

#### Класс ModalWithSuccess
Расширяет класс `Modal`. Предназначен для реализации модального окна с сообщением об успешном оформлении заказа. При открытии модального окна получает данные полной суммы товаров в корзине, которые нужно показать.\
Поля класса:
- `imageElement: HTMLImageElement` - элемент разметки с изображением.
- `fullPrice: HTMLElement` - элемент разметки для вывода полной стоимости товаров в корзине.
- `submitButton: HTMLButtonElement` - кнопка сабмита.

Методы:
- `submit(handleSubmit: Function): void` - принимает обработчик, который передается при инициации события клика по кнопке сабмита.

### Презентер
#### Класс AppApi

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список  событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классами моделями данных)_

- `items:change` - изменение массива товаров каталога
- `preview:change` - изменение открываемого в модальном окне товара
- `basket:change` - изменение списка товаров корзины
- `formErrors:change` - изменение в списке ошибок валидации формы

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_

- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `basket:open` - открытие корзины
- `card:select` - выбор карточки
- `order:open` - открытие окна оформления заказа
- `${form}:submit` - отправка формы со значениями полей
- `${form}.${field}:change` - изменение поля в форме

### Слой коммуникации FROM MESTO

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `user:changed` - изменение данных пользователя
- `cards:changed` - изменение массива карточек
- `card:selected` - изменение открываемой в модальном окне картинки карточки
- `card:previewClear` - необходима очистка данных выбранной для показа в модальном окне карточки

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `userEdit:open` - открытие модального окна с формой редактирования данных пользователя
- `newCard:open` - открытие модального окна создания новой карточки
- `avatar:open` - открытие модального окна с формой редактирования аватара пользователя
- `card:select` - выбор карточки для отображения в модальном окне
- `card:delete` - выбор карточки для удаления
- `card:like` - изменение состояния лайка на карточке
- `edit-profile:input` - изменение данных в форме с данными пользователя
- `edit-avatar:input` - изменение данных в форме с аватаром пользователя
- `new-place:input` - изменение данных в форме создания новой карточки
- `edit-profile:submit` - сохранение данных пользователя в модальном окне
- `edit-avatar:submit` - сохранение аватара пользователя в модальном окне
- `new-place:submit` - событие, генерируемое при создании новой карточки в форме
- `remove-card:submit` - событие, генерируемое при нажатии "Да" в форме подтверждения
- `edit-profile:validation` - событие, сообщающее о необходимости валидации формы профиля
- `edit-avatar:validation` - событие, сообщающее о необходимости валидации формы аватара пользователя
- `new-place:validation` - событие, сообщающее о необходимости валидации формы создания новой карточки