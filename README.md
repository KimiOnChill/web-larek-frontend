# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Макет
Макет предоставлен по ссылке.
[Link to Figma](https://www.figma.com/design/92C0vV1ZCsVpgN9cH2DZ2d/Yandex--%D0%92%D0%B5%D0%B1-%D0%BB%D0%B0%D1%80%D1%91%D0%BA-?node-id=201-9445&p=f&t=vSk2e25HzktweDDT-0)

## Ссылка на Github
https://github.com/KimiOnChill/web-larek-frontend

## Данные и типы данных, используемые в приложении
Интерфейс карточки:
```
export interface IItem {
  id: string;
  category: string;
  title: string;
  image: string;
  price: number | null;
  description: string;
  isBought?: boolean;
}
```
Интерфейс покупателя:
```
export interface ICustomer {
  paymentMethod: '' | 'card' | 'cash';
  address: string;
  email: string;
  phone: string;
}
```
Интерфейс корзины с товарами:
```
export interface IBasket {
  itemsList: IItem[];
  counter: number;
  fullPrice: number;
}
```
Интерфейс страницы с отображением всех товаров:
```
export interface IGallery {
  preview: string | null; 
  itemsArr: IItem[];
  events: IEvents;
}
```
Интерфейс ответа сервера о заказе:
```
export interface IOrderResponse {
  id: string;
  total: number;
}
```

## Арихитектура проекта
Проект построен в парадигме MVP:
- слой данных, отвечает за хранение и изменение данных,
- слой представления, отвечает за отображение данных на странице, 
- слой коммуникации выполняет роль презентера и отвечает за связь представления и данных.

### Базовый код
#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер.
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие.
- `emit` - инициализация события.
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие. 

### Слой данных
Здесь описаны объекты, которые хранят данные и содержат методы для возвращения или сохранения данных. Все поля классов будут защищенные.\
Почти любое действие в объекте будет эммитить определенное событие, чтобы в слой предсваления вносились изменения.

#### Класс GalleryModel
Класс хранит массив всех товаров, а также хранит товар, выбранный покупателем.\
В полях класса хранятся следующие данные:
- `preview: string | null` - id товара, выбранного для просмотра в модальной окне.
- `itemsArr: IItem[]` - массив всех товаров, полученный с сервера.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
Класс предоставляет набор методов для взаимодействия с этими данными:
- `getItem(itemId: string): IItem` - для получения карточки товара по ее id для `preview`.
- `setItem(item: IItem): void` - для сохранения карточки товара по ее id в `preview`.
- `getItemList(): IItem[]` - для получения массива товаров с сервера.
- `setItemList(itemList: IItem[]): void` - для сохранения массива товаров, полученных с сервера.  

#### Класс BasketModel
Класс отвечает за хранение и логику работы с данными карточек товаров, которые добавлены пользователем в корзину.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `basketItemsList: string[]` - массив id выбранных товаров.
- `fullPrice: number` - суммарная стоимость всех товаров.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
Класс предоставляет набор методов для взаимодействия с этими данными:
- `getBasket(): string[]` - для получения массива id товаров в корзине.
- `setBasket(basketItems: string[]): void` - сохранение маccива id выбранных товаров в полях класса.
- `addItem(id: string): void` - добавляет одну карточку по id в конец массива и вызывает событие изменения масива.
- `deleteItem(id: string): void` - удаляет карточку по id из массива.
- `countAmount(): number` - считает количество товаров в корзине для использования этого значения в счетчике.
- `includesItem(id: string): boolean` - определяет возможно ли купить товар.
- `clearBasket(): void` - полная очистка корзины. Вызовется после отправки заказа на сервер. 

#### Класс CustomerDataModel
Класс отвечает за хранение и логику работы с данными текущего покупателя.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся данные:
- `payment: string | null` - способ оплаты, выбранный покупателем. Всего три варианта: не указанный, кортой, наличными. 
- `address: string` - адрес покупателя.
- `email: string` - электронная почта покупателя.
- `phone: string` - телефон покупателя.
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
Класс предоставляет набор методов для взаимодействия с этими данными:
- `getCustomer()` - для получения всех данных о пользователе и заказе.
- `setOneInfo(field: keyof ICustomer, value: string): void` - сохраняет и валидирует данные покупателя в классе.
- `validateOrder(): boolean` - проверяет на валидность данные покупателя в форме order. (заполенено поле или нет).
- `validateContacts(): boolean` - проверяет на валидность данные покупателя в форме contacts. (заполенено поле или нет).
- `orderClear(): void` - очистка данных из модели.

### Слой отображения
Все классы в слое отображения (представления) отвечают за отрисовку передаваемых в них данных внутри контейнера (DOM-элемент).

#### Класс Page 
Наследует класс `Component`, отображает количество товаров в корзине и содержит поля:
- `basketElement: HTMLButtonElementr` - поле отображения иконки корзины.
- `counterElement: HTMLElement` - поле отображения значения счетчика на странице в элементе с классом `header__basket-counter`.
- `wrapperElement: HTMLElement` - вспомогательное поле для блокировки скрола.
- `galleryElement: HTMLElement` - поле отображения галереи товаров.
- `set counter(value: number)` - сеттер для обновления счетчика.
- `set catalog(items: HTMLElement[])` - сеттер для каталога.
- `set locked(value: boolean)` - сеттер для блокировки скрола.

#### Класс Card
Наследует класс `Component`, является родительским классом для отображения всех видов и экземпляров карточек товаров.\
В конструктор класса передается DOM элемент темплейта. В классе устанавлены слушатели на все интерактивные элементы, при взаимодействии с которыми генерируются соответствующие события.\
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Поля класса содержат элементы разметки элементов карточки: 
- `cardTitle: HTMLElement` - поле отображения названия товара.
- `cardPrice: HTMLElement` - поле отображения цены товара.
- `productId: string` - id товара.
- `cardButton: HTMLButtonElement` - для выбора всего элемента карточки для установки слушателя.
- `render(): HTMLElement` - метод возвращает карточку с установленными слушателями.

#### Класс CardInGallery
Расширяет класс `Card`, является родительским классом для карточки товара в модальном окне. Предназначен для отображения карточки товара в галерее.
Класс содержит такие поля:
- `cardCategory: HTMLElement` - поле отображения тэга товара.
- `image: HTMLElement` - поле отображения картинки товара.
- `cardSelectButton: HTMLButtonElement` - для выбора всего элемента карточки для открытия.

#### Класс CardInModal
Расширяет класс `CardInGallery`. Предназначен для отображения карточки товара в модальном окне.
Класс содержит такие поля:
- `cardDescription: HTMLElement` - поле отображения описания товара.

#### Класс CardInBasket
Расширяет класс `Card`. Предназначен для отображения карточки товара в корзине товаров.
Класс содержит такие поля:
- `cardNum: HTMLElement` - поле отображения порядкового номера товара в корзине.
- `cardDeleteButton: HTMLButtonElement` - поле кнопки удаления товара из корзины.

#### Класс Modal 
Наследует класс `Component`. Модальное окно - это независимое представление и оболочка, где в элемент с классoм `modal_content` будет склонировано содержимое темплейтов блоков. Предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.\
Класс содержит такие поля:
- `content: HTMLElement` - поле отображения склонированного контента.
- `closeModalButton: HTMLButtonElement` - поле кнопки закрытия модального окна.
- `set content(items: HTMLElement)` - сеттер для установки разметки контента.

#### Класс Basket
Наследует класс `Component`. Предназначен для отображения корзины товаров в модальном окне. Отображает карточки добавленных товаров в формате: номер по порядку, название товара, цена, кнопка удаления из корзины. Также отображает кнопку сабмита, которая активна, когда в корзине есть хотя бы один товар. Клик по кнопке передает в модальное окно контент формы оплаты и адреса. Рядом с кнопкой отображает суммарную стоимость всех товаров в корзине.\
Класс содержит такие поля:
- `basketItemsList: HTMLElement` - поле отображения списка покупок.
- `fullPrice: HTMLElement` - поле отображения суммарной стоимости товаров.
- `createOrderButton: HTMLButtonElement` - поле кнопки оформления заказа.
Методы:
- `set items(items: HTMLElement[])` - сеттер для установки массива товаров в корзине.
- `set total(total: number)` - сеттер для установки суммарной стоимости товаров.

#### Класс Form
Наследует класс `Component`. Родительский класс для реализации форм для заполнения даных о покупателе. При изменении одного поля происходит эмит события о данном изменении. Предоставляет методы для отображения ошибок и управления активностью кнопки сабмита.\
Поля класса:
- `submitButton: HTMLButtonElement` - поле кнопки сабмита.
- `errorField: HTMLElement` - поле для вывода ошибки валидации.
Методы:
- `set valid(value: boolean): void` - изменяет активность кнопки подтверждения.
- `set errors(value: string)` - сеттер для установки текста ошибки.
- `onInputChange(field: keyof T, value: string): void` - эмит события при взаимодействии с полями ввода.

#### Класс FormOrder
Расширяет класс `Form`. Назван по имени из HTML. Предназначен для отображения форм с выбором способа оплаты и укзанием адреса доставки.\
Поля класса:
- `buttonCard: HTMLButtonElement` - поля для отображения кнопоки способа оплаты картой.
- `buttonCash: HTMLButtonElement` - поля для отображения кнопоки способа оплаты при получении.
- `addressInput: HTMLInputElement` - поле инпута для ввода адреса.

#### Класс FormContacts
Расширяет класс `Form`. Назван по имени из HTML. Предназначен для отображения форм для ввода электронной почты и телефона.\
Поля класса:
- `emailInput: HTMLInputElement` - поля инпута для ввода электронной почты.
- `phoneInput: HTMLInputElement` - поле инпута для ввода номера телефона.

#### Класс Success
Наследует класс `Component`. Предназначен для отображения сообщения об успешном оформлении заказа в модальном окне. Отображает картинку и полную стоимость товаров в корзине.\
Поля класса:
- `happyButton: HTMLButtonElement` - поле для отображения поля с сообщением об успешной покупке.
- `totalPrice: HTMLElement` - поле для вывода полной стоимости товаров в корзине.
Методы:
- `set priceTotal(value: number)` - сеттер для установки суммарной стоимости товаров.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных, которые генерируются классами моделями данных:*
- `items:changed` - изменение массива товаров каталога.
- `item:selected` - изменение preview у модели.
- `basket:changed` - изменение списка товаров корзины с обновленим счетчика на иконке корзины.
- `validation:error` - валидация вывила ошибки.

*События, возникающие при взаимодействии пользователя с интерфейсом, генерируются классами, отвечающими за представление*
- `modal:open` - открытие модального окна.
- `modal:close` - закрытие модального окна с очищением форм и модели покупателя.
- `item:select` - выбор карточки для её открытия в модальном окне.
- `basket:open` - открытие корзины с товарами в модальном окне при клике на иконку корзины на главном экране.
- `${formName}:open` - открытие конкретной формы по атрибуту `name`.
- `${formName}.${field}:change` - изменение данных в конкретной форме по атрибуту `name` в конкретном поле.
- `${formName}:submit` - отправка конкретной формы по атрибуту `name`.
- `payment:change` - выбор способа оплаты при клике на одну из кнопок оплаты в форме order.
- `validation:error` - события для отображения сообщений о незаполненном поле в форме.
- `success:open` - открытие сообщения об успешном заказе в модальном окне при клике на кнопку сабмита в форме contacts.